import { createRequire as topLevelCreateRequire } from 'module';const require = topLevelCreateRequire(import.meta.url);import bannerUrl from 'url';const __dirname = bannerUrl.fileURLToPath(new URL('.', import.meta.url));
var s=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(r,t)=>(typeof require<"u"?require:r)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});import I from"node:path";import V from"node:http";var y=class extends V.IncomingMessage{constructor({method:r,url:t,headers:o,body:n,remoteAddress:i}){super({encrypted:!0,readable:!1,remoteAddress:i,address:()=>({port:443}),end:Function.prototype,destroy:Function.prototype}),typeof o["content-length"]>"u"&&(o["content-length"]=Buffer.byteLength(n).toString()),Object.assign(this,{ip:i,complete:!0,httpVersion:"1.1",httpVersionMajor:"1",httpVersionMinor:"1",method:r,headers:o,body:n,url:t}),this._read=()=>{this.push(n),this.push(null)}}};import z from"node:http";var b=`\r
\r
`,h=Symbol(),f=Symbol();function L(e){if(Buffer.isBuffer(e))return e.toString("utf8");if(ArrayBuffer.isView(e))return Buffer.from(e).toString("utf8");if(typeof e=="string")return e;throw new Error(`response.getString() of unexpected type: ${typeof e}`)}function E(e,r){if(Buffer.isBuffer(r)||ArrayBuffer.isView(r)||typeof r=="string")e[h].push(Buffer.from(r));else throw new Error(`response.addData() of unexpected type: ${typeof r}`)}var p=class extends z.ServerResponse{static from(r){let t=new p(r);return t.statusCode=r.statusCode,t[f]=r.headers,t[h]=[Buffer.from(r.body)],t.end(),t}static body(r){return Buffer.concat(r[h])}static headers(r){let t=typeof r.getHeaders=="function"?r.getHeaders():r._headers;return Object.assign(t,r[f])}get headers(){return this[f]}setHeader(r,t){this._wroteHeader?this[f][r]=t:super.setHeader(r,t)}writeHead(r,t,o){let n=typeof t=="string"?o:t;for(let i in n)if(this.setHeader(i,n[i]),!this._wroteHeader)break;super.writeHead(r,t,o)}constructor({method:r}){super({method:r}),this[h]=[],this[f]={},this.useChunkedEncodingByDefault=!1,this.chunkedEncoding=!1,this._header="",this.assignSocket({_writableState:{},writable:!0,on:Function.prototype,removeListener:Function.prototype,destroy:Function.prototype,cork:Function.prototype,uncork:Function.prototype,write:(t,o,n)=>{if(typeof o=="function"&&(n=o,o=null),this._header===""||this._wroteHeader)E(this,t);else{let i=L(t),a=i.indexOf(b);if(a!==-1){let d=i.slice(a+b.length);d&&E(this,d),this._wroteHeader=!0}}typeof n=="function"&&n()}}),this.once("finish",()=>{this.emit("close")})}};import u from"node:fs";import l from"node:path";function P(){process.env.NODE_ENV=process.env.NODE_ENV??"production"}function j(){return Math.random().toString(36).slice(2,8)}function q(e){let r=l.join(e,"required-server-files.json"),t=u.readFileSync(r,"utf-8"),{config:o}=JSON.parse(t);return o}function A(e){let r=l.join(e,"server","pages-manifest.json"),t=u.readFileSync(r,"utf-8");return Object.entries(JSON.parse(t)).filter(([o,n])=>n.endsWith(".html")).map(([o])=>o)}function _(e){let r=l.join(e,"public-files.json"),t=u.readFileSync(r,"utf-8");return JSON.parse(t)}function R(e){let r=l.join(e,"routes-manifest.json"),t=u.readFileSync(r,"utf-8"),o=JSON.parse(t);return[...o.staticRoutes,...o.dynamicRoutes]}function k(e){let r=l.join(e,"server","app-paths-manifest.json"),t=u.existsSync(r)?u.readFileSync(r,"utf-8"):"{}",o=JSON.parse(t);return Object.keys(o).map(n=>{let i=n.replace(/\/\(\w+\)|\/page$/g,"");return i===""?"/":i})}var G=new Set(["application/octet-stream","application/epub+zip","application/msword","application/pdf","application/rtf","application/vnd.amazon.ebook","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.wordprocessingml.document","font/otf","font/woff","font/woff2","image/bmp","image/gif","image/jpeg","image/png","image/tiff","image/vnd.microsoft.icon","image/webp","audio/3gpp","audio/aac","audio/basic","audio/mpeg","audio/ogg","audio/wavaudio/webm","audio/x-aiff","audio/x-midi","audio/x-wav","video/3gpp","video/mp2t","video/mpeg","video/ogg","video/quicktime","video/webm","video/x-msvideo","application/java-archive","application/vnd.apple.installer+xml","application/x-7z-compressed","application/x-apple-diskimage","application/x-bzip","application/x-bzip2","application/x-gzip","application/x-java-archive","application/x-rar-compressed","application/x-tar","application/x-zip","application/zip"]);function S(e){if(!e)return!1;let r=e?.split(";")[0]??"";return G.has(r)}function c(...e){}function U(e){return e.version==="2.0"}function J(e){return e.version===void 0&&!B(e)}function B(e){return e.Records!==void 0}function N(e){if(B(e))return K(e);if(U(e))return $(e);if(J(e))return X(e);throw new Error("Unsupported event type")}function C(e){if(e.type==="v2")return W(e);if(e.type==="v1")return Q(e);if(e.type==="cf")return Y(e);throw new Error("Unsupported event type")}function X(e){let{path:r,body:t,httpMethod:o,requestContext:n,isBase64Encoded:i}=e;return{type:"v1",method:o,rawPath:r,url:r+re(e),body:Buffer.from(t??"",i?"base64":"utf8"),headers:te(e),remoteAddress:n.identity.sourceIp}}function $(e){let{rawPath:r,rawQueryString:t,requestContext:o}=e;return{type:"v2",method:o.http.method,rawPath:r,url:r+(t?`?${t}`:""),body:ee(e),headers:Z(e),remoteAddress:o.http.sourceIp}}function K(e){let{method:r,uri:t,querystring:o,body:n,headers:i,clientIp:a}=e.Records[0].cf.request;return{type:"cf",method:r,rawPath:t,url:t+(o?`?${o}`:""),body:Buffer.from(n?.data??"",n?.encoding==="base64"?"base64":"utf8"),headers:oe(i),remoteAddress:a}}function Q(e){let r={},t={};Object.entries(e.headers).forEach(([n,i])=>{if(Array.isArray(i))t[n]=i;else{if(i===null){r[n]="";return}r[n]=i}});let o={statusCode:e.statusCode,headers:r,body:e.body,isBase64Encoded:e.isBase64Encoded,multiValueHeaders:t};return c(o),o}function W(e){let r={};Object.entries(e.headers).filter(([o])=>o.toLowerCase()!=="set-cookie").forEach(([o,n])=>{if(n===null){r[o]="";return}r[o]=Array.isArray(n)?n.join(", "):n.toString()});let t={statusCode:e.statusCode,headers:r,cookies:e.headers["set-cookie"],body:e.body,isBase64Encoded:e.isBase64Encoded};return c(t),t}function Y(e){let r={};Object.entries(e.headers).filter(([o])=>o.toLowerCase()!=="content-length").forEach(([o,n])=>{r[o]=[...r[o]||[],...Array.isArray(n)?n.map(i=>({key:o,value:i})):[{key:o,value:n.toString()}]]});let t={status:e.statusCode.toString(),statusDescription:"OK",headers:r,bodyEncoding:e.isBase64Encoded?"base64":"text",body:e.body};return c(t),t}function Z(e){let{headers:r,cookies:t}=e,o={};Array.isArray(t)&&(o.cookie=t.join("; "));for(let[n,i]of Object.entries(r||{}))o[n.toLowerCase()]=i;return o}function ee(e){let{body:r,isBase64Encoded:t}=e;return Buffer.isBuffer(r)?r:typeof r=="string"?Buffer.from(r,t?"base64":"utf8"):typeof r=="object"?Buffer.from(JSON.stringify(r)):Buffer.from("","utf8")}function re(e){let r=new URLSearchParams;for(let[o,n]of Object.entries(e.multiValueQueryStringParameters||{}))if(n!==void 0)for(let i of n)r.append(o,i);let t=r.toString();return t?`?${t}`:""}function te(e){e.multiValueHeaders;let r={};for(let[t,o]of Object.entries(e.multiValueHeaders||{}))o&&(r[t.toLowerCase()]=o.join(","));for(let[t,o]of Object.entries(e.headers||{}))o&&(r[t.toLowerCase()]=o);return r}function oe(e){let r={};for(let[t,o]of Object.entries(e))for(let{value:n}of o)n&&(r[t.toLowerCase()]=n);return r}var x=s("module"),ne=x._resolveFilename,O=new Map,H=new Map;function F(e){try{se(),ie(e)}catch(r){throw console.error("Failed to override Next.js require hooks.",r),r}}function m(e=[],r){for(let[t,o]of e)r==="app"?O.set(t,o):H.set(t,o)}function se(){m([["styled-jsx",s.resolve("styled-jsx")],["styled-jsx/style",s.resolve("styled-jsx/style")],["styled-jsx/style",s.resolve("styled-jsx/style")]],"app")}function ie(e){m([["react",s.resolve("react")],["react/jsx-runtime",s.resolve("react/jsx-runtime")]],"page");try{m([["react/jsx-dev-runtime",s.resolve("react/jsx-dev-runtime")]],"page")}catch{}e.experimental.appDir&&(e.experimental.serverActions?m([["react",s.resolve("next/dist/compiled/react-experimental")],["react/jsx-runtime",s.resolve("next/dist/compiled/react-experimental/jsx-runtime")],["react/jsx-dev-runtime",s.resolve("next/dist/compiled/react-experimental/jsx-dev-runtime")],["react-dom",s.resolve("next/dist/compiled/react-dom-experimental/server-rendering-stub")],["react-dom/client",s.resolve("next/dist/compiled/react-dom-experimental/client")],["react-dom/server",s.resolve("next/dist/compiled/react-dom-experimental/server")],["react-dom/server.browser",s.resolve("next/dist/compiled/react-dom-experimental/server.browser")],["react-dom/server.edge",s.resolve("next/dist/compiled/react-dom-experimental/server.edge")],["react-server-dom-webpack/client",s.resolve("next/dist/compiled/react-server-dom-webpack-experimental/client")],["react-server-dom-webpack/client.edge",s.resolve("next/dist/compiled/react-server-dom-webpack-experimental/client.edge")],["react-server-dom-webpack/server.edge",s.resolve("next/dist/compiled/react-server-dom-webpack-experimental/server.edge")],["react-server-dom-webpack/server.node",s.resolve("next/dist/compiled/react-server-dom-webpack-experimental/server.node")]],"app"):m([["react",s.resolve("next/dist/compiled/react")],["react/jsx-runtime",s.resolve("next/dist/compiled/react/jsx-runtime")],["react/jsx-dev-runtime",s.resolve("next/dist/compiled/react/jsx-dev-runtime")],["react-dom",s.resolve("next/dist/compiled/react-dom/server-rendering-stub")],["react-dom/client",s.resolve("next/dist/compiled/react-dom/client")],["react-dom/server",s.resolve("next/dist/compiled/react-dom/server")],["react-dom/server.browser",s.resolve("next/dist/compiled/react-dom/server.browser")],["react-dom/server.edge",s.resolve("next/dist/compiled/react-dom/server.edge")],["react-server-dom-webpack/client",s.resolve("next/dist/compiled/react-server-dom-webpack/client")],["react-server-dom-webpack/client.edge",s.resolve("next/dist/compiled/react-server-dom-webpack/client.edge")],["react-server-dom-webpack/server.edge",s.resolve("next/dist/compiled/react-server-dom-webpack/server.edge")],["react-server-dom-webpack/server.node",s.resolve("next/dist/compiled/react-server-dom-webpack/server.node")]],"app"))}function ae(){return process.env.__NEXT_PRIVATE_PREBUNDLED_REACT==="next"||process.env.__NEXT_PRIVATE_PREBUNDLED_REACT==="experimental"}function T(){x._resolveFilename=function(e,r,t,o,n,i,a){let d=ae()?r.get(o):t.get(o);return d&&(o=d),e.call(x,o,n,i,a)}.bind(null,ne,O,H)}import le from"next/dist/server/next-server.js";var v=I.join(__dirname,".next"),D=I.join(__dirname,".open-next");c({NEXT_DIR:v,OPEN_NEXT_DIR:D});P();ve();var g=q(v),ce=A(v),de=R(v),pe=k(v),ue=_(D),fe=`server-${j()}`;F(g);T();var me=new le.default({hostname:"localhost",port:Number(process.env.PORT)||3e3,conf:{...g,compress:!1},customServer:!1,dev:!1,dir:__dirname}).getRequestHandler();async function Ge(e){if(c("event",e),"type"in e)return we(e);let r=N(e);if(r.headers["x-forwarded-host"]&&(r.headers.host=r.headers["x-forwarded-host"]),ue.files.includes(r.rawPath))return r.type==="cf"?ge(e):xe();let t={method:r.method,url:r.url,headers:r.headers,body:r.body,remoteAddress:r.remoteAddress};c("IncomingMessage constructor props",t);let o=new y(t),n=new p({method:t.method});ye(r.rawPath,g),await he(o,n);let i=n.statusCode||200,a=p.headers(n),d=S(Array.isArray(a["content-type"])?a["content-type"][0]:a["content-type"]),M=d?"base64":"utf8",w=p.body(n).toString(M);return c("ServerResponse data",{statusCode:i,headers:a,isBase64Encoded:d,body:w}),ce.includes(r.rawPath)&&a["cache-control"]&&(a["cache-control"]="public, max-age=0, s-maxage=31536000, must-revalidate"),C({type:r.type,statusCode:i,headers:a,isBase64Encoded:d,body:w})}function ve(){process.chdir(__dirname)}function ye(e,r){let t=de.find(n=>new RegExp(n.regex).test(e??"")),o=pe.includes(t?.page??"");if(c("setNextjsPrebundledReact",{url:e,isApp:o,route:t}),o){process.env.__NEXT_PRIVATE_PREBUNDLED_REACT=r.experimental.serverActions?"experimental":"next";return}process.env.__NEXT_PRIVATE_PREBUNDLED_REACT=void 0}async function he(e,r){delete e.body;try{await me(e,r)}catch(t){console.error("NextJS request failed.",t),r.setHeader("Content-Type","application/json"),r.end(JSON.stringify({message:"Server failed to respond.",details:t},null,2))}}function xe(){return{statusCode:503}}function ge(e){return e.Records[0].cf.request}function we(e){return new Promise(r=>{setTimeout(()=>{r({serverId:fe})},e.delay)})}export{Ge as handler};
